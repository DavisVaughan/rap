---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# zap

[![Lifecycle Status](https://img.shields.io/badge/lifecycle-experimental-blue.svg)](https://www.tidyverse.org/lifecycle/)

Experimenting with yet another way to do rowwise operations. It might never be a thing, 
and I'm not yet sure this is `quo()`rrect. 

This offers `zap()` as an alternative to some versions of:

 - `rowwise()` + `do()`
 - `mutate()` + `pmap()`
 - maybe `purrrlyr` ?
 - probably other approaches

`zap()` works with a lambda, similar to `purrr::map()` but instead of `.x`, `.y`, `..1`, `..2`, ...
the lambda can use the column names, which stand for a single element of the associated vector, in the 
`[[` sense. 

## Installation

You can install `zap` from gitub

``` r
# install.packages("devtools")
detools::install_github("romainfrancois/zap")
```

## Example

```{r}
library(tidyverse)
library(zap)

tbl <- tibble(cyl = c(4, 6, 8), mpg = c(30, 25, 20)) 
tbl
```

Based on this [issue](https://github.com/tidyverse/purrr/issues/280), we want subset of 
rows of `mtcars` where `cyl` is equal to the `tbl$cyl` and `mpg` is smaller than `tbl$mpg`

There are many ways to do that, on the issue Jenny uses a `mutate + pmap` idiom: 

```{r}
tbl %>%
  mutate(x = pmap(
    .l = list(cyl, mpg),
    function(cc, mm) filter(mtcars, cyl == cc, mpg < mm))
  )
```

`zap` attemps to simplify this by iterating over the columns simultaneously, and exposing 
them with their name: 

```{r}
tbl %>% 
  zap(x = ~filter(mtcars, cyl == !!cyl, mpg < !!mpg) )
```

In `purrr::` fashion, `zap()` has variants to force the type of output, e.g. `zap_int()`: 

```{r}
tbl %>% 
  zap(x = ~filter(mtcars, cyl == !!cyl, mpg < !!mpg) ) %>% 
  zap_int( n = ~nrow(x))
```

## wap

`wap()` is the same but just returns the columns, `wap()` is `zap()` + `dplyr::pull()`

```{r}
library(dplyr)

starwars <- head(starwars)

# creates a list of length 1 integer vectors
starwars %>% 
  wap(~length(films)) 

# using .ptype or the _int suffix to get a integer vector instead
starwars %>% 
  wap(~length(films), .ptype = integer())
starwars %>% 
  wap_int(~length(films))

# list of data frames
starwars %>% 
  wap(~data.frame(vehicles = length(vehicles), starships = length(starships)))

# using .ptype = data.frame() or _dfr to rbind them
starwars %>% 
  wap(~ data.frame(vehicles = length(vehicles), starships = length(starships)), .ptype = data.frame())
starwars %>% 
  wap_dfr(~data.frame(vehicles = length(vehicles), starships = length(starships)))
```







